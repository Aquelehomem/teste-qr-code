<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Entrega - Condom√≠nio</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<style>
  body{
    width:70%;
    margin:0 auto;
  }
  h1{
    display: block;
    margin: 0 auto;
    width:50%;
  }
  .mainContainer{
    margin:0 auto;
    width: 70%;
  }
  p{display: block;}
</style>
</head>
<body>

<h1 id="registro">Registro de Entrega</h1>
 <div class="mainContainer"  class="mb-3" class="container-fluid">
<p id="condominio"></p>
<form id="entregaForm">

  <p id="infoCondominio"></p>

  <input type="hidden" id="condominioId" name="condominioId">

  <label>
    Bloco (de 1 a 4)
      <select name="" class="form-select" id="bloco" size="4" required>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    Apartamento / Casa
    <input type="number" id="apartamento" class="form-control" placeholder="n√∫mero do apartamento" required>
    Nome do entregador
    <input type="text" class="form-control" id="nome">
    Nome do destin√°tario
    <input type="text" name="" class="form-control" id="destinatario">
    <label for="phone">Telefone:</label>
    <input type="tel" class="form-control" id="telefone" name="telefone" placeholder="(XX) XXXXX-XXXX">
  </label>
<div>
  <label>
    Tipo de entrega
    <select id="tipo" class="form-select" required>
      Selecione
      <option>Correios</option>
      <option>Mercado livre</option>
      <option>Transportadora</option>
      <option>shopee</option>
      <option>amazon</option>
      <option>Outros</option>
    </select>
  </label>
  </div>
  <label>
    Outros
    <textarea id="outros" class="form-control" placeholder="outros tipos de entrega"></textarea>
  </label>
  <div class="form-check">
  Entrega na portaria?
  <div>
   <label for="agree_yes">
            <input type="radio" class="form-check-input" id="radio" name="portaria" value="true">
            Yes
        </label>
  </div>
  <div>      
        <label for="agree_no">
            <input type="radio" class="form-check-input" checked id="radio" name="portaria" value="">
            No
        </label>
  </div>      
  <button class="btn btn-primary" type="submit">Confirmar entrega</button>
  </div>
</form>
</div>


<div class="modal fade" id="comprovanteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Comprovante de Entrega</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p><strong>Condom√≠nio:</strong> <span id="m-condominio"></span></p>
        <p><strong>Empresa:</strong> <span id="m-empresa"></span></p>
        <p><strong>Destino:</strong> <span id="m-destino"></span></p>
        <p><strong>Data:</strong> <span id="m-data"></span></p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-bs-dismiss="modal">
          OK
        </button>
      </div>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>


<script>
  // üî¥ COLE AQUI a configura√ß√£o que o Firebase te deu
  const firebaseConfig = {
  apiKey: "AIzaSyDMTaSjpwQsL04JxiRZHju0wXMpJnZ4_cI",
  authDomain: "boxia-entregas.firebaseapp.com",
  projectId: "boxia-entregas",
  storageBucket: "boxia-entregas.firebasestorage.app",
  messagingSenderId: "697886386308",
  appId: "1:697886386308:web:71562c4e11463c02ccbad1"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  document.getElementById("entregaForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    var selected = Boolean(document.querySelector('input[name="portaria"]:checked'));
    const params = new URLSearchParams(window.location.search);
    const condominioId = params.get("condominio");
    const now = new Date();
    const selectElement = document.getElementById("bloco");
// Simple localized time (e.g., "7:22:00 PM" or "19:22:00")
    const localizedTime = now.toLocaleTimeString(); 
    let date = new Date().toLocaleDateString('pt-BR');
    const telefone=parseInt(document.getElementById("telefone").value);
    
    const dados = {
      condominioId: condominioId,
      apartamento: document.getElementById("apartamento").value,
      bloco: selectElement.value,
      tipoEntrega: document.getElementById("tipo").value,
      portaria: selected,
      hora: localizedTime,
      data:date,
      outros: document.getElementById("outros").value,
      nome:document.getElementById("nome").value,
      destinatario: document.getElementById("destinatario").value,
      telefone: telefone
      
    };
    try {
      const docRef = await db.collection("entregas").add(dados)
      const protocolo = docRef.id
      alert("Entrega registrada com sucesso!");
      showModal(dados);

      this.reset();
    } catch (erro) {
      console.error(erro);
      alert("Erro ao registrar entrega");
    }


    function showModal(dados){
      document.getElementById("m-condominio").innerText = dados.condominioId;
      document.getElementById("m-empresa").innerText = dados.tipoEntrega;
      document.getElementById("m-destino").innerText = dados.destinatario
     dados.bloco && dados.apartamento
      ? `Bloco ${dados.bloco} - Apto ${dados.apartamento}`
      : "Portaria";

  document.getElementById("m-data").innerText =
    `Hor√°rio: ${dados.hora} - data:${dados.data}`

  // abrir o modal
  const modal = new bootstrap.Modal(
    document.getElementById("comprovanteModal")
  );
  modal.show();
    }
  });
</script>
</body>
</html>