<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Entrega - Condom√≠nio</title>
  <link href="https://cdn.jsdelivr.net" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>
<body>

<h1>Registro de Entrega</h1>
 <div class="form-group">
<p id="condominio"></p>
<form id="entregaForm">

  <p id="infoCondominio"></p>

  <input type="hidden" id="condominioId" name="condominioId">

  <label>
    Bloco (de 1 a 4)
      <select name="" id="bloco" size="4">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    Apartamento / Casa
    <input type="number" id="apartamento" placeholder="n√∫mero do apartamento" required>
    Nome do entregador
    <input type="text" id="nome">
    Nome do destin√°tario
    <input type="text" name="" id="destinatario">
    <label for="phone">Telefone:</label>
    <input type="tel" id="telefone" name="telefone" placeholder="(XX) XXXXX-XXXX">
  </label>

  <label>
    Tipo de entrega
    <select id="tipo" required>
      Selecione
      <option>Correios</option>
      <option>Mercado livre</option>
      <option>Transportadora</option>
      <option>shopee</option>
      <option>amazon</option>
      <option>Outros</option>
    </select>
  </label>

  <label>
    Outros
    <textarea id="outros" placeholder="outros tipos de entrega"></textarea>
  </label>
  Entrega na portaria?
   <label for="agree_yes">
            <input type="radio" id="radio" name="portaria" value="true">
            Yes
        </label>
        
        <label for="agree_no">
            <input type="radio" checked id="radio" name="portaria" value="">
            No
        </label>
  <button type="submit">Confirmar entrega</button>

</form>
</div>



<script src="https://cdn.jsdelivr.net" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>


<script>
  // üî¥ COLE AQUI a configura√ß√£o que o Firebase te deu
  const firebaseConfig = {
  apiKey: "AIzaSyDMTaSjpwQsL04JxiRZHju0wXMpJnZ4_cI",
  authDomain: "boxia-entregas.firebaseapp.com",
  projectId: "boxia-entregas",
  storageBucket: "boxia-entregas.firebasestorage.app",
  messagingSenderId: "697886386308",
  appId: "1:697886386308:web:71562c4e11463c02ccbad1"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  document.getElementById("entregaForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    var selected = Boolean(document.querySelector('input[name="portaria"]:checked'));
    const params = new URLSearchParams(window.location.search);
    const condominioId = params.get("condominio");
    const now = new Date();
    const selectElement = document.getElementById("bloco");
// Simple localized time (e.g., "7:22:00 PM" or "19:22:00")
    const localizedTime = now.toLocaleTimeString(); 
    let date = new Date().toLocaleDateString('pt-BR');
    const telefone=parseInt(document.getElementById("telefone").value);
    
    const dados = {
      condominioId: condominioId,
      apartamento: document.getElementById("apartamento").value,
      bloco: selectElement.value,
      tipoEntrega: document.getElementById("tipo").value,
      portaria: selected,
      hora: localizedTime,
      data:date,
      outros: document.getElementById("outros").value,
      nome:document.getElementById("nome").value,
      destinatario: document.getElementById("destinatario").value,
      telefone: telefone
      
    };
    try {
      const docRef = await db.collection("entregas").add(dados)
      const protocolo = docRef.id
      alert("Entrega registrada com sucesso!");
      

      this.reset();
    } catch (erro) {
      console.error(erro);
      alert("Erro ao registrar entrega");
    }
  });
</script>
</body>
</html>